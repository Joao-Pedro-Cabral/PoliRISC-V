digraph fsm {
    rankdir="LR"
    node [shape = circle];

    idle [label = "idle"];
    wait_any_mem [label = "wait_any_mem"];
    wait_inst_mem [label = "wait_inst_mem"];
    wait_data_mem [label = "wait_data_mem"];

    idle -> wait_inst_mem [fontsize="10" label="~read_data_mem & ~write_data_mem /\nbusy, inst_mem_en"];
    idle -> wait_any_mem [fontsize="10" label = "read_data_mem | write_data_mem /\nbusy, inst_mem_en, data_mem_en,\ndata_mem_we <- write_data_mem"];
    wait_any_mem -> idle [fontsize="10" label = "inst_mem_ack & data_mem_ack"];
    wait_any_mem -> wait_inst_mem [fontsize="10" label = "data_mem_ack & ~inst_mem_ack /\nbusy, inst_mem_en"];
    wait_any_mem -> wait_data_mem [fontsize="10" label = "inst_mem_ack & ~data_mem_ack /\nbusy, data_mem_en,\ndata_mem_we <- write_data_mem"];
    wait_any_mem -> wait_any_mem [fontsize="10" label = "~inst_mem_ack & ~data_mem_ack /\nbusy, inst_mem_en, data_mem_en,\ndata_mem_we <- write_data_mem"];
    wait_inst_mem -> idle [fontsize="10" label = "inst_mem_ack"];
    wait_inst_mem -> wait_inst_mem [fontsize="10" label = "~inst_mem_ack / busy, inst_mem_en"];
    wait_data_mem -> idle [fontsize="10" label = "data_mem_ack"];
    wait_data_mem -> wait_data_mem [fontsize="10" label = "~data_mem_ack /\nbusy, data_mem_en,\ndata_mem_we <- write_data_mem"];
}

// inputs:
// read_data_mem
// write_data_mem
// inst_mem_ack
// data_mem_ack

// outputs:
// busy
// inst_mem_stb
// data_mem_stb
// inst_mem_cyc
// data_mem_cyc
// data_mem_we
